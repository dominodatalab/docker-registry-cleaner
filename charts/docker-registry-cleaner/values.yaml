image:
  repository: quay.io/domino/docker-registry-cleaner
  tag: v0.3.0
  pullPolicy: Always

# fsGroup makes the PVC at /data/reports writable by nonroot (65532)
podSecurityContext:
  fsGroup: 65532

# Resource requests and limits for the container
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 1000m
    memory: 1Gi

# Optional env overrides (e.g. REGISTRY_URL for ECR)
env:
  registryUrl: ""  # Set to registry host (e.g. 946429944765.dkr.ecr.eu-west-1.amazonaws.com) to override config

# Additional environment variables to add to the container
# Supports full Kubernetes env var syntax including valueFrom
# Example:
# extraEnv:
#   - name: AWS_DEFAULT_REGION
#     value: "us-west-2"
#   - name: CUSTOM_SECRET
#     valueFrom:
#       secretKeyRef:
#         name: my-secret
#         key: password
extraEnv: []

imagePullSecrets:
  - name: domino-quay-repos

serviceAccount:
  create: true
  name: docker-registry-cleaner
  # Optional: override full name; by default uses release-name + chart name
  fullnameOverride: ""

dominoPlatformNamespace: domino-platform

persistence:
  enabled: true
  size: 10Gi
  storageClass: "dominodisk"  # Use default storage class if empty

config:
  # Inline config.yaml content mounted into the container
  registry:
    url: "docker-registry:5000"
    repository: "dominodatalab"
  mongo:
    host: "mongodb-replicaset"
    port: 27017
    replicaset: "rs0"
    db: "domino"
  analysis:
    max_workers: 4
    timeout: 300
    output_dir: "/data/reports"
  retry:
    max_retries: 3
    initial_delay: 1.0
    max_delay: 60.0
    exponential_base: 2.0
    jitter: true
    timeout: 300
  cache:
    enabled: true
    tag_list_ttl: 1800
    tag_list_max_size: 100
    image_inspect_ttl: 3600
    image_inspect_max_size: 1000
    mongo_query_ttl: 600
    mongo_query_max_size: 500
    layer_calc_ttl: 7200
    layer_calc_max_size: 2000
  s3:
    bucket: ""
    region: "us-west-2"
  skopeo:
    rate_limit:
      enabled: true  # Enable rate limiting for registry operations
      requests_per_second: 10.0  # Maximum requests per second (adjust based on registry capacity)
      burst_size: 20  # Allow burst of up to N requests (helps with parallel operations)
  reports:
    archived_tags: "archived-tags.json"
    deletion_analysis: "deletion-analysis.json"
    filtered_layers: "filtered-layers.json"
    image_analysis: "final-report.json"
    images_report: "images-report"
    layers_and_sizes: "layers-and-sizes.json"
    mongodb_usage: "mongodb_usage_report.json"
    tags_per_layer: "tags-per-layer.json"
    tag_sums: "tag-sums.json"
    unused_references: "unused-references.json"
  security:
    dry_run_by_default: true
    require_confirmation: true
